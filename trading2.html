<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="GRIDGOLDGO">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    
    <title>GRIDGOLDGO - PORT 2 Terminal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        * { box-sizing: border-box; }
        
        body { 
            background-color: #1a1a1a; 
            color: #eeeeee; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            padding: 10px; 
            margin: 0;
            user-select: none;
            display: flex;
            justify-content: center; 
            align-items: center; 
            min-height: 100vh;
        }

        .pin-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; }
        .pin-title { color: #FFD700; font-size: 1.2rem; margin-bottom: 20px; font-weight: bold; }
        .pin-dots { display: flex; gap: 20px; margin-bottom: 40px; }
        .dot { width: 15px; height: 15px; border-radius: 50%; border: 2px solid #FFD700; transition: 0.2s; }
        .dot.active { background-color: #FFD700; box-shadow: 0 0 10px #FFD700; }
        
        .numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .num-btn { width: 70px; height: 70px; border-radius: 50%; background-color: #252525; border: 1px solid #444; color: white; font-size: 1.5rem; font-weight: bold; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.5); }
        .num-btn:active { background-color: #444; transform: scale(0.95); }
        .num-btn.clear-btn { color: #FF4500; font-size: 1.2rem; }

        .dash-container { background-color: #252525; border: 1px solid #444; padding: 15px; border-radius: 12px; width: 100%; max-width: 450px; box-shadow: 0 8px 25px rgba(0,0,0,0.9); display: none; }
        .logo-container { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 5px; margin-top: 5px; }
        .logo-text { font-size: clamp(1.3rem, 6vw, 1.6rem); font-weight: 900; letter-spacing: 0.5px; font-family: 'Arial Black', Impact, sans-serif; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .txt-grid { color: #ffffff; } .txt-gold { color: #FFD700; } .txt-go { color: #00FF7F; }
        .price-display { color: #00BFFF; font-weight: bold; font-size: clamp(1.3rem, 6vw, 1.7rem); text-align: center; margin-bottom: 20px; text-shadow: 0 0 10px rgba(0, 191, 255, 0.4); font-family: 'Courier New', Courier, monospace;}
        .data-row { display: flex; justify-content: space-between; align-items: center; font-size: clamp(0.9rem, 4vw, 1rem); margin-bottom: 6px; }
        .data-label { color: #dcdcdc; } .data-val { color: #ffffff; font-weight: 500; text-align: right;}
        .divider { border-bottom: 1px dashed #666; margin: 12px 0; }
        .text-green { color: #00FF00 !important; } .text-red { color: #FF4500 !important; }
        
        .btn-panel { display: flex; gap: 10px; margin-top: 20px; }
        .btn-custom { flex: 1; padding: 12px 5px; font-weight: bold; font-size: clamp(0.8rem, 3.5vw, 1rem); border: none; border-radius: 6px; cursor: pointer; color: white; transition: 0.1s; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        .btn-custom:active { transform: scale(0.95); box-shadow: 0 1px 2px rgba(0,0,0,0.3); }
        .btn-closeall { background-color: #d32f2f; } .btn-run { background-color: #2e7d32; } .btn-pause { background-color: #c2185b; }
        .chart-box { background-color: #1e1e1e; border: 1px solid #333; border-radius: 8px; padding: 10px 5px 0px 5px; margin: 15px 0; width: 100%;}
    </style>
</head>
<body>

    <div class="pin-screen" id="pinScreen">
        <div class="logo-container" style="margin-bottom: 30px;">
            <svg width="60" height="60" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <defs><linearGradient id="goldGradient" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#FFEA70" /><stop offset="50%" stop-color="#FFD700" /><stop offset="100%" stop-color="#D4AF37" /></linearGradient></defs>
                <rect x="5" y="5" width="90" height="90" rx="20" fill="#111" stroke="url(#goldGradient)" stroke-width="3"/>
                <line x1="35" y1="5" x2="35" y2="95" stroke="#333" stroke-width="1"/><line x1="65" y1="5" x2="65" y2="95" stroke="#333" stroke-width="1"/>
                <line x1="5" y1="35" x2="95" y2="35" stroke="#333" stroke-width="1"/><line x1="5" y1="65" x2="95" y2="65" stroke="#333" stroke-width="1"/>
                <rect x="22" y="60" width="12" height="20" rx="2" fill="url(#goldGradient)"/><rect x="44" y="45" width="12" height="35" rx="2" fill="url(#goldGradient)"/><rect x="66" y="25" width="12" height="55" rx="2" fill="url(#goldGradient)"/>
                
                <polyline points="15,65 44,40 60,52 78,23.2" fill="none" stroke="#00FF7F" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                <polygon points="4,0 -12,-8 -8,0 -12,8" fill="#00FF7F" transform="translate(80, 20) rotate(-58)"/>
            </svg>
        </div>
        <div class="pin-title" id="pinTitle">‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô 4 ‡∏´‡∏•‡∏±‡∏Å</div>
        <div class="pin-dots">
            <div class="dot" id="dot1"></div><div class="dot" id="dot2"></div><div class="dot" id="dot3"></div><div class="dot" id="dot4"></div>
        </div>
        <div class="numpad">
            <div class="num-btn" onclick="enterPin('1')">1</div><div class="num-btn" onclick="enterPin('2')">2</div><div class="num-btn" onclick="enterPin('3')">3</div>
            <div class="num-btn" onclick="enterPin('4')">4</div><div class="num-btn" onclick="enterPin('5')">5</div><div class="num-btn" onclick="enterPin('6')">6</div>
            <div class="num-btn" onclick="enterPin('7')">7</div><div class="num-btn" onclick="enterPin('8')">8</div><div class="num-btn" onclick="enterPin('9')">9</div>
            <div class="num-btn clear-btn" onclick="clearPin()">DEL</div><div class="num-btn" onclick="enterPin('0')">0</div><div></div>
        </div>
    </div>

    <div class="dash-container" id="mainApp">
        <div class="logo-container">
            <svg width="45" height="45" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <defs><linearGradient id="goldGradient2" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#FFEA70" /><stop offset="50%" stop-color="#FFD700" /><stop offset="100%" stop-color="#D4AF37" /></linearGradient></defs>
                <rect x="5" y="5" width="90" height="90" rx="20" fill="#111" stroke="url(#goldGradient2)" stroke-width="3"/>
                <line x1="35" y1="5" x2="35" y2="95" stroke="#333" stroke-width="1"/><line x1="65" y1="5" x2="65" y2="95" stroke="#333" stroke-width="1"/>
                <line x1="5" y1="35" x2="95" y2="35" stroke="#333" stroke-width="1"/><line x1="5" y1="65" x2="95" y2="65" stroke="#333" stroke-width="1"/>
                <rect x="22" y="60" width="12" height="20" rx="2" fill="url(#goldGradient2)"/><rect x="44" y="45" width="12" height="35" rx="2" fill="url(#goldGradient2)"/><rect x="66" y="25" width="12" height="55" rx="2" fill="url(#goldGradient2)"/>
                
                <polyline points="15,65 44,40 60,52 78,23.2" fill="none" stroke="#00FF7F" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                <polygon points="4,0 -12,-8 -8,0 -12,8" fill="#00FF7F" transform="translate(80, 20) rotate(-58)"/>
            </svg>
            <div class="logo-text"><span class="txt-grid">GRID</span><span class="txt-gold">GOLD</span><span class="txt-go">GO</span></div>
        </div>

        <div class="price-display" id="v_price">XAUUSD: 0.00</div>
        <div class="data-row"><span class="data-label">Broker:</span><span class="data-val" id="v_broker">Loading...</span></div>
        <div class="data-row"><span class="data-label">ID:</span><span class="data-val" id="v_id">---</span></div>
        <div class="data-row"><span class="data-label">Balance:</span><span class="data-val" id="v_bal">0.00</span></div>
        <div class="data-row"><span class="data-label">Equity:</span><span class="data-val" id="v_eq">0.00</span></div>
        <div class="data-row"><span class="data-label">Profit (Now):</span><span class="data-val text-green" id="v_profnow">0.00 (0 ord)</span></div>

        <div class="chart-box"><div id="growthChart"></div></div>

        <div class="data-row"><span class="data-label">Lots (Open):</span><span class="data-val" id="v_lotopen">0.00</span></div>
        <div class="data-row"><span class="data-label">Lots (Today):</span><span class="data-val" id="v_lottoday">0.00</span></div>
        <div class="data-row"><span class="data-label">Lots (Total):</span><span class="data-val" id="v_lottotal">0.00</span></div>
        <div class="divider"></div>
        <div class="data-row"><span class="data-label">Profit (Day):</span><span class="data-val" id="v_profday">0.00</span></div>
        <div class="data-row"><span class="data-label">Profit (Total):</span><span class="data-val" id="v_proftotal">0.00</span></div>
        <div class="divider"></div>
        <div class="data-row"><span class="data-label">DD (Now):</span><span class="data-val" id="v_ddnow">0.00 %</span></div>
        <div class="data-row"><span class="data-label">DD (Max):</span><span class="data-val" id="v_ddmax">0.00 %</span></div>

        <div class="btn-panel">
            <button class="btn-custom btn-closeall" onclick="sendCommand('CLOSE_ALL')">CLOSE ALL</button>
            <button class="btn-custom btn-run" id="btn_state" onclick="sendCommand('TOGGLE_RUN')">RUNNING</button>
        </div>
        <div style="text-align: center; color: #555; font-size: 0.75rem; margin-top: 15px;"><span id="v_time">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span></div>
    </div>

    <script>
        const SECRET_PIN = "8888"; 
        
        let currentPin = "";
        function updateDots() {
            for(let i=1; i<=4; i++) {
                let dot = document.getElementById('dot'+i);
                if(i <= currentPin.length) dot.classList.add('active');
                else dot.classList.remove('active');
            }
        }
        function enterPin(num) {
            if(currentPin.length < 4) {
                currentPin += num;
                updateDots();
                if(currentPin.length === 4) {
                    setTimeout(() => { checkPin(); }, 150); 
                }
            }
        }
        function clearPin() {
            currentPin = "";
            updateDots();
            document.getElementById('pinTitle').innerText = "‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô 4 ‡∏´‡∏•‡∏±‡∏Å";
            document.getElementById('pinTitle').style.color = "#FFD700";
        }
        function checkPin() {
            if(currentPin === SECRET_PIN) {
                document.getElementById('pinScreen').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                window.dispatchEvent(new Event('resize')); 
            } else {
                document.getElementById('pinTitle').innerText = "‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î! ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà";
                document.getElementById('pinTitle').style.color = "#FF4500";
                currentPin = "";
                updateDots();
            }
        }

        const FIREBASE_DATA = "https://mt5-dashboard-985da-default-rtdb.asia-southeast1.firebasedatabase.app/mt5_data2.json";
        const FIREBASE_CMD = "https://mt5-dashboard-985da-default-rtdb.asia-southeast1.firebasedatabase.app/mt5_command2.json";

        function fmt(num) { return parseFloat(num).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }); }

        var chartOptions = {
            series: [{ name: 'Balance', data: [] }, { name: 'Equity', data: [] }],
            chart: { type: 'area', height: 180, toolbar: { show: false }, animations: { enabled: false }, parentHeightOffset: 0 },
            colors: ['#008FFB', '#00E396'], fill: { type: 'gradient', gradient: { shadeIntensity: 1, opacityFrom: 0.4, opacityTo: 0.05, stops: [0, 100] } },
            dataLabels: { enabled: false }, stroke: { curve: 'smooth', width: 2 },
            xaxis: { categories: [], labels: { show: false }, axisBorder: { show: false }, axisTicks: { show: false } },
            yaxis: { labels: { style: { colors: '#888' }, formatter: (val) => { return val.toFixed(0); } } },
            tooltip: { theme: 'dark' }, grid: { borderColor: '#444', strokeDashArray: 3, padding: { top: -20, bottom: -10, left: 10, right: 10 } },
            legend: { position: 'top', horizontalAlign: 'right', labels: { colors: '#fff' } }
        };
        var myChart = new ApexCharts(document.querySelector("#growthChart"), chartOptions);
        myChart.render();

        async function updateDashboard() {
            if(document.getElementById('mainApp').style.display !== 'block') return;

            try {
                const res = await fetch(FIREBASE_DATA);
                const d = await res.json();
                if(!d) return;

                // üåü ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏π‡πà‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                if(d.current_price !== undefined) { 
                    let symName = d.symbol_name ? d.symbol_name : "SYMBOL"; 
                    document.getElementById('v_price').innerText = symName + ": " + fmt(d.current_price); 
                } else if(d.xauusd_price !== undefined) { 
                    // ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÑ‡∏ß‡πâ‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î Python ‡∏ï‡∏±‡∏ß‡πÄ‡∏Å‡πà‡∏≤
                    document.getElementById('v_price').innerText = "XAUUSD: " + fmt(d.xauusd_price); 
                }

                document.getElementById('v_broker').innerText = d.broker;
                document.getElementById('v_id').innerText = d.id;
                document.getElementById('v_bal').innerText = fmt(d.balance);
                document.getElementById('v_eq').innerText = fmt(d.equity);
                
                const profNow = document.getElementById('v_profnow');
                profNow.innerText = `${fmt(d.profit_now)} (${d.ord_count} ord)`;
                profNow.className = d.profit_now < 0 ? "data-val text-red" : "data-val text-green";

                document.getElementById('v_lotopen').innerText = fmt(d.lots_open);
                document.getElementById('v_lottoday').innerText = fmt(d.lots_today);
                document.getElementById('v_lottotal').innerText = fmt(d.lots_total);
                document.getElementById('v_profday').innerText = fmt(d.prof_day);
                document.getElementById('v_proftotal').innerText = fmt(d.prof_total);
                document.getElementById('v_ddnow').innerText = fmt(d.dd_now) + " %";
                document.getElementById('v_ddmax').innerText = fmt(d.dd_max) + " %";

                const btnState = document.getElementById('btn_state');
                if(d.is_paused) { btnState.innerText = "PAUSED"; btnState.className = "btn-custom btn-pause"; } 
                else { btnState.innerText = "RUNNING"; btnState.className = "btn-custom btn-run"; }

                document.getElementById('v_time').innerText = "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: " + d.timestamp;

                if (d.chart_data && d.chart_data.length > 0) {
                    let times = d.chart_data.map(item => item.time);
                    let bals = d.chart_data.map(item => item.bal);
                    let eqs = d.chart_data.map(item => item.eq);
                    myChart.updateOptions({ xaxis: { categories: times } });
                    myChart.updateSeries([{ name: 'Balance', data: bals }, { name: 'Equity', data: eqs }]);
                }
            } catch (e) { console.log(e); }
        }

        async function sendCommand(actionType) {
            if(actionType === 'CLOSE_ALL') {
                if(!confirm("‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏û‡∏≠‡∏£‡πå‡∏ï ‡∏õ‡∏¥‡∏î‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
            }
            await fetch(FIREBASE_CMD, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ action: actionType, ts: Date.now() })
            });
        }

        updateDashboard();
        setInterval(updateDashboard, 1500); 
    </script>
</body>
</html>