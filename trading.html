<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GRIDGOLDGO Terminal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #1a1a1a; color: #eeeeee; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 15px; user-select: none;}
        .dash-container { background-color: #252525; border: 1px solid #444; padding: 20px; border-radius: 5px; max-width: 400px; margin: 0 auto; box-shadow: 0 4px 15px rgba(0,0,0,0.8);}
        .title { color: #FFD700; font-weight: bold; font-size: 1.3rem; text-align: center; margin-bottom: 15px; }
        .data-row { display: flex; justify-content: space-between; font-size: 1rem; margin-bottom: 5px; }
        .data-label { color: #dcdcdc; }
        .data-val { color: #ffffff; font-weight: 500; }
        .divider { border-bottom: 1px dashed #666; margin: 12px 0; }
        .text-green { color: #00FF00 !important; }
        .text-red { color: #FF4500 !important; }
        .btn-panel { display: flex; gap: 10px; margin-top: 20px; }
        .btn-custom { flex: 1; padding: 10px; font-weight: bold; border: none; border-radius: 3px; cursor: pointer; color: white; transition: 0.1s;}
        .btn-custom:active { transform: scale(0.95); }
        .btn-closeall { background-color: #FF0000; }
        .btn-run { background-color: #008000; }
        .btn-pause { background-color: #B22222; }
    </style>
</head>
<body>

    <div class="dash-container">
        <div class="title">GRIDGOLDGO</div>

        <div class="data-row"><span class="data-label">Broker:</span><span class="data-val" id="v_broker">Loading...</span></div>
        <div class="data-row"><span class="data-label">ID:</span><span class="data-val" id="v_id">---</span></div>
        <div class="data-row"><span class="data-label">Balance:</span><span class="data-val" id="v_bal">0.00</span></div>
        <div class="data-row"><span class="data-label">Equity:</span><span class="data-val" id="v_eq">0.00</span></div>
        <div class="data-row"><span class="data-label">Profit (Now):</span><span class="data-val text-green" id="v_profnow">0.00 (0 ord)</span></div>

        <div class="divider"></div>

        <div class="data-row"><span class="data-label">Lots (Open):</span><span class="data-val" id="v_lotopen">0.00</span></div>
        <div class="data-row"><span class="data-label">Lots (Today):</span><span class="data-val" id="v_lottoday">0.00</span></div>
        <div class="data-row"><span class="data-label">Lots (Total):</span><span class="data-val" id="v_lottotal">0.00</span></div>

        <div class="divider"></div>

        <div class="data-row"><span class="data-label">Profit (Day):</span><span class="data-val" id="v_profday">0.00</span></div>
        <div class="data-row"><span class="data-label">Profit (Total):</span><span class="data-val" id="v_proftotal">0.00</span></div>

        <div class="divider"></div>

        <div class="data-row"><span class="data-label">DD (Now):</span><span class="data-val" id="v_ddnow">0.00 %</span></div>
        <div class="data-row"><span class="data-label">DD (Max):</span><span class="data-val" id="v_ddmax">0.00 %</span></div>

        <div class="btn-panel">
            <button class="btn-custom btn-closeall" onclick="sendCommand('CLOSE_ALL')">CLOSE ALL</button>
            <button class="btn-custom btn-run" id="btn_state" onclick="sendCommand('TOGGLE_RUN')">RUNNING</button>
        </div>
        
        <div style="text-align: center; color: #555; font-size: 0.7rem; margin-top: 15px;">
            <span id="v_time">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
        </div>
    </div>

    <script>
        // ==========================================
        // üî¥ ‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå Firebase ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        // ==========================================
        const FIREBASE_DATA = "https://mt5-dashboard-985da-default-rtdb.asia-southeast1.firebasedatabase.app/mt5_data.json";
        const FIREBASE_CMD = "https://mt5-dashboard-985da-default-rtdb.asia-southeast1.firebasedatabase.app/mt5_command.json";

        function fmt(num) { return parseFloat(num).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }); }

        async function updateDashboard() {
            try {
                const res = await fetch(FIREBASE_DATA);
                const d = await res.json();
                if(!d) return;

                document.getElementById('v_broker').innerText = d.broker;
                document.getElementById('v_id').innerText = d.id;
                document.getElementById('v_bal').innerText = fmt(d.balance);
                document.getElementById('v_eq').innerText = fmt(d.equity);
                
                const profNow = document.getElementById('v_profnow');
                profNow.innerText = `${fmt(d.profit_now)} (${d.ord_count} ord)`;
                profNow.className = d.profit_now < 0 ? "data-val text-red" : "data-val text-green";

                document.getElementById('v_lotopen').innerText = fmt(d.lots_open);
                document.getElementById('v_lottoday').innerText = fmt(d.lots_today);
                document.getElementById('v_lottotal').innerText = fmt(d.lots_total);

                document.getElementById('v_profday').innerText = fmt(d.prof_day);
                document.getElementById('v_proftotal').innerText = fmt(d.prof_total);

                document.getElementById('v_ddnow').innerText = fmt(d.dd_now) + " %";
                document.getElementById('v_ddmax').innerText = fmt(d.dd_max) + " %";

                const btnState = document.getElementById('btn_state');
                if(d.is_paused) {
                    btnState.innerText = "PAUSED";
                    btnState.className = "btn-custom btn-pause";
                } else {
                    btnState.innerText = "RUNNING";
                    btnState.className = "btn-custom btn-run";
                }

                document.getElementById('v_time').innerText = "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: " + d.timestamp;
            } catch (e) { console.log(e); }
        }

        async function sendCommand(actionType) {
            if(actionType === 'CLOSE_ALL') {
                if(!confirm("‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏õ‡∏¥‡∏î‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå XAUUSD ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) return;
            }
            
            // ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô Firebase (Python ‡∏à‡∏∞‡∏Ñ‡∏≠‡∏¢‡∏î‡∏∂‡∏á‡πÑ‡∏õ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠)
            await fetch(FIREBASE_CMD, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ action: actionType, ts: Date.now() })
            });
        }

        updateDashboard();
        setInterval(updateDashboard, 1500); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏∏‡∏Å 1.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    </script>
</body>
</html>